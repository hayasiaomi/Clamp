<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>善点客户端</title>
    <link href="assets/css/site.css" rel="stylesheet">
    <link href="assets/css/default.css" rel="stylesheet">
    <script type="text/javascript">

        var textfield = null;
        var isFormError = false;

        function txtOnFocus(sender, inputid) {

            if (textfield == null) {
                textfield = sender;
                document.getElementById(textfield.id + "group").className = "input-group input-group--active";
            }
            else {
                if (this.textfield != sender) {
                    document.getElementById(textfield.id + "group").className = "input-group";
                    textfield = sender;
                    document.getElementById(textfield.id + "group").className = "input-group input-group--active";
                }
                else {

                    var textfieldgroup = document.getElementById(textfield.id + "group");

                    if (!textfieldgroup.classList.contains("input-group--active")) {
                        textfieldgroup.className = "input-group input-group--active";
                    }
                }
            }

            if (isFormError) {
                setFormError(false, "");
                isFormError = false;
            }

            dropdownUsername(false);
        }

        
        function txtUsernameOnblur(sender)
        {
            if (sender.value != null && sender.value != "") {
                restoreRememberPasssword(sender.value);
            }
        }

        function txtUsernameOnInput() {
            document.getElementById("inputpassword").value = "";
            document.getElementById("inputRememberPassword").checked = false;
            SwitchRememberPassword(false);
        }

        function setFormError(flag, error) {
            var formerror = document.getElementById("formerror");

            if (flag) {
                formerror.innerText = error;
                formerror.removeAttribute("style");
            }
            else {
                formerror.innerText = error;
                formerror.style.display = "none";
            }
        }


        function appMainOnClick() {
            var inputgroup = document.getElementById("inputusernamegroup");

            var className = inputgroup.className;

            if (className.indexOf("dropdown-open input-group-active") != -1) {
                dropdownUsername(false);
            }
        }


        function windowOnClose() {
            window.SD.close();
        }

        function windowOnMaxmize() {
            window.SD.setWindowMaxmize();
        }

        function windowOnMinimize() {
            window.SD.setWindowMinimize();
        }

        function keyboardOnClick(sender) {

            var aside = document.getElementsByTagName("aside");

            if (aside != null && aside.length > 0) {

                if (aside[0].hasAttribute("hidden")) {
                    aside[0].removeAttribute("hidden");
                    sender.className = "keyboard-switch-btn";
                }
                else {
                    aside[0].setAttribute("hidden", "hidden");
                    sender.className = "keyboard-switch-btn keyboard-switch-btn--closed";
                }
            }
        }

        function keyboardButtonOnClick(sender) {

            if (textfield != null) {
                textfield.value = textfield.value + sender.innerText;
                textfield.focus();
            }
        }

        function keyboardClearOnClick(sender) {

            if (textfield != null) {
                textfield.value = "";
                textfield.focus();
            }
        }

        function keyboardBackspaceOnClick() {

            if (textfield != null && textfield.value != null && textfield.value != "") {
                var len = textfield.value.length;
                textfield.value = textfield.value.substring(0, len - 1);
                textfield.focus();
            }
        }


        function prevUsernameOnClick(e) {

            e.stopPropagation();

            var inputgroup = document.getElementById("inputusernamegroup");

            var className = inputgroup.className;

            if (className.indexOf("dropdown-open input-group-active") != -1) {
                inputgroup.className = className.replace(" dropdown-open input-group-active", "");
                document.getElementById("el-popover-3766").style.display = "none";
            }
            else {
                inputgroup.className = className + " dropdown-open input-group-active"

                document.getElementById("el-popover-3766").style.display = "";


            }
        }


        function dropdownUsername(state) {
            var inputgroup = document.getElementById("inputusernamegroup");

            var className = inputgroup.className;

            if (!state) {
                inputgroup.className = className.replace(" dropdown-open input-group-active", "");
                document.getElementById("el-popover-3766").style.display = "none";
            }
            else {
                inputgroup.className = className + " dropdown-open input-group-active"

                document.getElementById("el-popover-3766").style.display = "";

                document.getElementById("accountlist").focus();
            }
        }

        function chooseUsernameOnClick(e) {
            e.stopPropagation();

            var username = e.target.innerText;

            restoreRememberPasssword(username);

            dropdownUsername(false);
        }

        function chooseRemoveUsernameOnClick(e) {

            e.stopPropagation();

            var value = e.target.getAttribute("data-value");

            window.SD.removeLicenseUsername(value);

            dropdownUsername(false);

            var accountlist = document.getElementById("accountlist");

            var removeItem = document.getElementById("item" + value);

            if (removeItem != null) {
                accountlist.removeChild(removeItem);
            }
        }

        function loginOnClick(sender) {

            loginLoading(true);

            var inputusername = document.getElementById("inputusername");
            var inputpassword = document.getElementById("inputpassword");
            var inputRememberPassword = document.getElementById("inputRememberPassword");

            if (inputusername.value == null || inputusername.value == "") {
                document.getElementById(inputusername.id + "group").className = "input-group input-group--error";
                loginLoading(false);

                inputusername.focus();
                return;
            }

            if (inputpassword.value == null || inputpassword.value == "") {
                document.getElementById(inputpassword.id + "group").className = "input-group input-group--error";

                loginLoading(false);

                inputpassword.focus();
                return;
            }

            window.SD.authorize(inputusername.value, inputpassword.value, inputRememberPassword.checked, loginCallback);
        }

        function loginLoading(state) {
            var btnLogin = document.getElementById("btnLogin");
            var imgloading = document.getElementById("imgloading");
            var txtloading = document.getElementById("txtloading");
            var btnloginvalue = document.getElementById("btnloginvalue");


            if (state) {
                btnLogin.setAttribute("disabled", "disabled");
                btnloginvalue.style.display = "none";
                imgloading.removeAttribute("style");
                txtloading.removeAttribute("style");
            }
            else {
                btnloginvalue.removeAttribute("style");
                imgloading.style.display = "none";
                txtloading.style.display = "none";
                btnLogin.removeAttribute("disabled")
            }
        }

        function loginCallback(flag, code, message) {
            if (!flag) {
                setFormError(!flag, message);
                isFormError = true;

                var inputpassword = document.getElementById("inputpassword");

                inputpassword.value = "";
            }
            loginLoading(false);
        }

        function checkRememberPassword(sender) {
            ChangeRememberPasswordStyle(sender.checked)
        }

        function SwitchRememberPassword(checked) {

            var inputRememberPassword = document.getElementById("inputRememberPassword");

            if (checked) {

                if (!inputRememberPassword.checked) {
                    inputRememberPassword.checked = true;
                }

            }
            else {

                if (inputRememberPassword.checked) {
                    inputRememberPassword.checked = false;
                }
            }

            ChangeRememberPasswordStyle(checked);
        }

        function ChangeRememberPasswordStyle(checked) {
            var lebelRememberPassword = document.getElementById("lebelRememberPassword");
            var spanRememberPassword = document.getElementById("spanRememberPassword");

            if (checked) {

                lebelRememberPassword.className = "el-checkbox is-checked";
                lebelRememberPassword.setAttribute("aria-checked", "true");

                spanRememberPassword.className = "el-checkbox__input is-checked";
            }
            else {

                lebelRememberPassword.className = "el-checkbox";
                lebelRememberPassword.removeAttribute("aria-checked");
                spanRememberPassword.className = "el-checkbox__input";
            }
        }

        function restoreRememberPasssword(username) {
            var userInfoValue = window.SD.getLicenseNumberInfo(username);

            if (userInfoValue != null && /\S/.test(userInfoValue)) {

                var userInfo = JSON.parse(userInfoValue);

                if (userInfo != null) {

                    document.getElementById("inputusername").value = username;
                    document.getElementById("inputpassword").value = userInfo.Password;

                    SwitchRememberPassword(userInfo.IsMemberkPassword);
                }
            }
        }

    </script>
</head>
<body>
    <div id="app">
        <div class="__module-intro__">
            <div class="module-intro module-intro__sign-in">
                <div class="intro-app-top-bar">
                    <div class="intro-app-top-bar__title">善点V<span id="appVersion"></span></div>
                    <div class="window-operator">
                        <button class="window-operator-minmize" onclick="windowOnMinimize()"></button>
                        <button class="window-operator-maximize" onclick="windowOnMaxmize()"></button>
                        <button class="window-operator-close" onclick="windowOnClose()"></button>
                    </div>
                </div>
                <div class="intro-app-main" onclick="appMainOnClick()">
                    <div class="intro-container">
                        <div class="sign-in__top-space"></div>
                        <div class="sign-in__header">
                            <div class="logo"></div>
                            <div class="slogan"> 最贴地气的/餐厅信息化/智能工具</div>
                        </div>
                        <div class="sign-in__form">
                            <form class="form">
                                <div class="form-group form-group--row form-group--lg">
                                    <div id="inputusernamegroup" class="input-group">
                                        <div class="input-group-addon">
                                            <i class="icon-user"></i>
                                        </div>
                                        <input id="inputusername" type="text" placeholder="输入账号" oninput="txtUsernameOnInput(this)"  onblur="txtUsernameOnblur(this)" autofocus onfocus="txtOnFocus(this)" maxlength="20" autocomplete="off" class="form-control" data-keyboard="true">
                                        <div class="input-group-addon" onclick="prevUsernameOnClick(event)">
                                            <div> <i class="icon-dropdown"></i></div>
                                        </div>
                                        <!---->
                                    </div>
                                    <span>
                                        <div role="tooltip" id="el-popover-3766" aria-hidden="true" class="el-popover el-popper account-list-popover" style="width: 320px; display: none;">
                                            <!---->
                                            <div id="accountlist" class="account-list">

                                            </div>
                                        </div>
                                    </span>
                                </div>
                                <div class="form-group form-group--row form-group--lg">
                                    <div id="inputpasswordgroup" class="input-group">
                                        <div class="input-group-addon">
                                            <i class="icon-lock"></i>
                                        </div>
                                        <input id="inputpassword" type="password" placeholder="输入密码" maxlength="20" onfocus="txtOnFocus(this)" autocomplete="off" class="form-control" data-keyboard="true">
                                        <!----> <!---->
                                    </div>
                                </div>
                                <div class="help" style="margin-bottom: 10px;">
                                    <a href="#" hidden="hidden">
                                        <i class="icon-help"></i> 帮助
                                    </a>
                                </div>
                                <div class="form-control-checkbox">
                                    <label id="lebelRememberPassword" role="checkbox" class="el-checkbox" aria-checked="true">
                                        <span id="spanRememberPassword" aria-checked="mixed" class="el-checkbox__input"><span class="el-checkbox__inner"></span><input id="inputRememberPassword" type="checkbox" class="el-checkbox__original" value="" onclick="checkRememberPassword(this)"></span><span class="el-checkbox__label">
                                            记住密码
                                        </span>
                                    </label>
                                </div>
                                <button id="btnLogin" type="button" class="btn btn-primary btn-lg btn-block" onclick="loginOnClick(this)">
                                    <div style="background-color:palegreen">
                                        <div style="width:40%;float:left;text-align:right; height:48px;"><i id="imgloading" class="loading" style="display: none;"></i></div>
                                        <div style="width:20%;float:left;text-align:center;height:48px;line-height:48px;">
                                            <span id="btnloginvalue">登 录</span>
                                            <span id="txtloading" style="display: none;">登录中</span>
                                        </div>
                                        <div style="width:40%;float:left;clear:both"></div>
                                    </div>
                                </button>
                                <div id="formerror" class="form-error" style="display: none;">

                                </div>
                            </form>
                        </div>
                        <div id="" class="keyboard-container">
                            <aside role="application" data-value="" data-layout="number" class="app-keyboard empty">
                                <div class="app-keyboard-row">
                                    <button role="button" type="button" aria-disabled="false" tabindex="-1" class="app-keyboard-key" onclick="keyboardButtonOnClick(this)">1</button>
                                    <button class="app-keyboard-key" onclick="keyboardButtonOnClick(this)">2</button>
                                    <button class="app-keyboard-key" onclick="keyboardButtonOnClick(this)">3</button>
                                </div>
                                <div class="app-keyboard-row">
                                    <button class="app-keyboard-key" onclick="keyboardButtonOnClick(this)">4</button>
                                    <button class="app-keyboard-key" onclick="keyboardButtonOnClick(this)">5</button>
                                    <button class="app-keyboard-key" onclick="keyboardButtonOnClick(this)">6</button>
                                </div>
                                <div class="app-keyboard-row">
                                    <button class="app-keyboard-key" onclick="keyboardButtonOnClick(this)">7</button>
                                    <button class="app-keyboard-key" onclick="keyboardButtonOnClick(this)">8</button>
                                    <button class="app-keyboard-key" onclick="keyboardButtonOnClick(this)">9</button>
                                </div>
                                <div class="app-keyboard-row">
                                    <button class="app-keyboard-key" onclick="keyboardClearOnClick()">清空</button> <!---->
                                    <button class="app-keyboard-key" onclick="keyboardButtonOnClick(this)">0</button>
                                    <button class="app-keyboard-key app-keyboard-key--size-md" onclick="keyboardBackspaceOnClick(this)"><i class="icon-backspace"></i></button>
                                </div>
                                <!----> <!---->
                            </aside>
                        </div>
                    </div>
                    <div class="keyboard-switch-btn" onclick="keyboardOnClick(this)"> 键盘  </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">


        document.getElementById("appVersion").innerText = window.SD.finalVersion;

        document.getElementById("inputusername")
            .addEventListener("keyup", function (event) {
                event.preventDefault();
                if (event.keyCode === 13) {
                    document.getElementById("btnLogin").click();
                }

                if (isFormError) {
                    setFormError(false, "");
                    isFormError = false;
                }
            });

        document.getElementById("inputpassword")
            .addEventListener("keyup", function (event) {
                event.preventDefault();
                if (event.keyCode === 13) {
                    document.getElementById("btnLogin").click();
                }

                if (isFormError) {
                    setFormError(false, "");
                    isFormError = false;
                }
            });
    </script>

    <script type="text/javascript">

        var licenseUsernamesValue = window.SD.getLicenseUsernames();

        if (licenseUsernamesValue != null && /\S/.test(licenseUsernamesValue)) {

            var licenseUsernames = JSON.parse(licenseUsernamesValue);

            if (licenseUsernames != null) {

                var accountlist = document.getElementById("accountlist");

                for (var i = 0; i < licenseUsernames.length; i++) {

                    var node = document.createElement("div");

                    node.id = "item" + licenseUsernames[i];
                    node.className = "account-item";
                    node.innerHTML = "<span class=\"label\" onclick=\"chooseUsernameOnClick(event)\">" + licenseUsernames[i] + "</span> <span class=\"close\"  data-value=\"" + licenseUsernames[i] + "\"  onclick=\"chooseRemoveUsernameOnClick(event)\" ></span>";

                    accountlist.appendChild(node);
                }
            }
        }

    </script>
</body>
</html>
